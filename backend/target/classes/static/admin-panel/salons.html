<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin | Salons</title>

    <!-- CORRECTED CSS PATH -->
    <link rel="stylesheet" href="/admin-panel/assets/css/dashboard.css">

    <link rel="shortcut icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

<nav class="navbar navbar-dark bg-dark px-3">
    <span class="navbar-brand">Admin Panel</span>
    <button class="btn btn-danger" onclick="logout()">Logout</button>
</nav>

<div class="container mt-4">
    <h2>Salon Approval List</h2>

    <table class="table table-striped mt-3" id="salonTable">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Salon Name</th>
            <th>City</th>
            <th>Status</th>
            <th>Owner</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    const token = localStorage.getItem("adminToken");
    const API_BASE =
        window.location.origin.includes("63342")
            ? "http://localhost:8080"
            : window.location.origin;

    if (!token) {
        window.location.href = "/admin-panel/login.html";
    }

    // Fetch salons
    async function loadSalons() {
        const res = await fetch(`${API_BASE}/api/admin/salons`, {
            headers: {
                "Authorization": "Bearer " + token
            }
        });

        const data = await res.json();
        const tbody = document.querySelector("#salonTable tbody");
        tbody.innerHTML = "";

        data.forEach(s => {
            const row = `
                <tr>
                    <td>${s.id}</td>
                    <td>${s.salonName}</td>
                    <td>${s.city}</td>
                    <td><span class="badge bg-primary">${s.approvalStatus}</span></td>
                    <td>${s.ownerName || 'N/A'}</td>
                    <td>
                        <button class="btn btn-success btn-sm" onclick="approveSalon(${s.id})">Approve</button>
                        <button class="btn btn-danger btn-sm" onclick="rejectSalon(${s.id})">Reject</button>
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    async function approveSalon(id) {
        const adminId = localStorage.getItem("adminId");

        await fetch(`${API_BASE}/api/admin/salon/approve/${id}?adminId=${adminId}`, {
            method: "POST",
            headers: { "Authorization": "Bearer " + token }
        });

        loadSalons();
    }

    async function rejectSalon(id) {
        const adminId = localStorage.getItem("adminId");

        await fetch(`${API_BASE}/api/admin/salon/reject/${id}?adminId=${adminId}`, {
            method: "POST",
            headers: { "Authorization": "Bearer " + token }
        });

        loadSalons();
    }

    function logout() {
        localStorage.clear();
        window.location.href = "/admin-panel/login.html";
    }

    loadSalons();
</script>

</body>
</html>
