<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin | Users</title>

    <!-- FIXED CSS PATH -->
    <link rel="stylesheet" href="/admin-panel/assets/css/dashboard.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
<nav class="navbar navbar-dark bg-dark px-3">
    <span class="navbar-brand">Admin Panel</span>
    <button class="btn btn-danger" onclick="logout()">Logout</button>
</nav>

<div class="container mt-4">
    <h2>All Registered Users</h2>

    <table class="table table-bordered table-striped mt-3" id="userTable">
        <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Mobile</th>
            <th>Email</th>
            <th>Role</th>
            <th>Status</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    const token = localStorage.getItem("adminToken");

    const API_BASE =
        window.location.origin.includes("63342")
            ? "http://localhost:8080"
            : window.location.origin;

    if (!token) {
        window.location.href = "/admin-panel/login.html";
    }

    async function loadUsers() {
        const res = await fetch(`${API_BASE}/api/user/all`, {
            headers: {
                "Authorization": "Bearer " + token
            }
        });

        const data = await res.json();

        const tbody = document.querySelector("#userTable tbody");
        tbody.innerHTML = "";

        data.forEach(u => {
            const row = `
                <tr>
                    <td>${u.id}</td>
                    <td>${u.name}</td>
                    <td>${u.mobile}</td>
                    <td>${u.email}</td>
                    <td>${u.role}</td>
                    <td>${u.isActive ?
                       '<span class="badge bg-success">Active</span>' :
                       '<span class="badge bg-danger">Blocked</span>'}
                    </td>
                </tr>
            `;
            tbody.innerHTML += row;
        });
    }

    function logout() {
        localStorage.clear();
        window.location.href = "/admin-panel/login.html";
    }

    // Load users
    loadUsers();
</script>

</body>
</html>
